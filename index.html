<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Screens</title>
        <script type="text/javascript" src="node_modules/d3/d3.js"></script>
        <script type="text/javascript" src="node_modules/crossfilter/crossfilter.js"></script>
        <script type="text/javascript" src="node_modules/dc/dc.js"></script>
        <link   type="text/css"        href="node_modules/dc/dc.css" rel="stylesheet">
        <script type="text/javascript" src="node_modules/jquery/dist/jquery.js"></script>
        <script type="text/javascript" src="node_modules/bootstrap/dist/js/bootstrap.js"></script>
        <link   type="text/css"        href="node_modules/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
        <script type="text/javascript" src="node_modules/colorbrewer/colorbrewer.js"></script>
        <link   type="text/css"        href="d3.slider/d3.slider.css" rel="stylesheet">
        <script type="text/javascript" src="d3.slider/d3.slider.js"></script>
   

    </head>

<body>
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">

        <div class="container" id="container1">

            <div class="navbar-header">
                
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                
                <a class="navbar-brand">Catchy Screens</a>

            </div>
            
            <div class="collapse navbar-collapse">
                
                <ul class="nav navbar-nav"></ul>
            
            </div><!--/.nav-collapse -->

        </div>

    </div>

   

    <div class="container" role="main" id="container2">

        <div class="jumbotron">

            <div class="row" id="1">

                    <figure id="chart1" class="dc-chart col-md-6">
                        <a class="reset" href="javascript:typeChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>

                    </figure>

                   <figure id="chart2" class="dc-chart col-md-6" style="display:none;">
                        <a class="reset" href="javascript:resolutionChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>

                    </figure>

            </div> <!-- end row 1 -->
          
          <div class="row" id="2">
            <h3>Resolution <span id="slidertextmin"> </span> , <span id="slidertextmax"></span></h3>
            <div id="slider" class="d3-slider d3-slider-horizontal" ></id>

          </div> <!-- end row 2 -->

          <div class="row" id="3">

                <figure class="dc-chart dc-data-count col-md-12" style="display: block;">
                    
                    <span class="filter-count"></span> selected out of <span class="total-count"></span> records | 
                    <a href="javascript:dc.filterAll(); dc.renderAll();" style="display:none;">Reset</a>
                
                </figure>

          </div> <!-- end row 3 -->

          <div class="row" id="4">

                <table id="list" class="table table-hover dc-data-table dc-chart col-md-4" style="margin-top:5%;">
                    <thead>
                        <tr id="FieldNames" class="header" style="text-align:left;"></tr>
                    </thead>
                </table> 

          </div> <!-- end row 4 -->
        </div> <!-- end jumbotron -->
    </div> <!-- end container -->
     
<script type="text/javascript">

    var typeChart = dc.rowChart("figure#chart1");
    var resolutionChart = dc.barChart("figure#chart2");
    var dataTable = dc.dataTable("#list");
    var countWidget = dc.dataCount("figure.dc-data-count");
    var dispatch = d3.dispatch("load","filter");
    var CrossFilter = crossfilter();
    var formatNumber = d3.format("d,");
    function hypotenuse(w,h) {
        var w = +w;
        var h = +h;
        var r = Math.sqrt(Math.pow(w,2) + Math.pow(h,2));
        return r;
    };

    d3.csv('data/data.csv', function(Data){
        dispatch.load(Data);
    });

    dispatch.on("load", function(Data) {

        Data.forEach(function(d){

            var TypeString = d.Type;
            var TypeSansSpace = TypeString.toLowerCase()
                .replace("desktop","")
                .replace(" ","");
            
            d.Price             = +d.Price
            d.WeightGrams       = +d.WeightGrams;
            d.DiameterInches    = +d.DiameterInches;
            d.HorizontalPixels  = +d.HorizontalPixels;
            d.VerticalPixels    = +d.VerticalPixels;
            d.BrightnessNits    = +d.BrightnessNits;
            
            d.PPI =  Math.round(hypotenuse(d.HorizontalPixels,d.VerticalPixels)/d.DiameterInches);
            
            d.Type = TypeSansSpace;

        });

            CrossFilter.add(Data);

        var BrightnessAccessor = function(d){return d.BrightnessNits;},
            BrightnessExtent = [],
            BrightnessExtent = d3.extent(Data,BrightnessAccessor);

        var ResolutionAccessor = function(d){return d.PPI;},
            ResolutionExtent = [],
            ResolutionExtent = d3.extent(Data,ResolutionAccessor);

        var TypeDimension = CrossFilter.dimension(function(d) { return d.Type;}),
            TypeGroup = TypeDimension.group(),
            CompanyDimension = CrossFilter.dimension(function(d) { return d.Company;}),
            CompanyGroup = CompanyDimension.group(),
            ResolutionDimension = CrossFilter.dimension(function(d) { return d.PPI;}),
            ResolutionGroup = ResolutionDimension.group(),
            BrightnessDimension = CrossFilter.dimension(function(d) { return +d.BrightnessNits}),
            BrightnessGroup = BrightnessDimension.group();
        
        //  try slider with dispatch /////////////////



        d3.select('#slider').call(d3.slider().axis(true).min(ResolutionExtent[0]-1).max(1+ResolutionExtent[1])
            .value(ResolutionExtent)
            .on("slide", function(evt, value) {
                var _newRange = dc.filters.RangedFilter(value[0],value[1]);
                dispatch.filter(_newRange);
                d3.select('span#slidertextmin').text(Math.floor(value[0]));
                d3.select('span#slidertextmax').text(Math.floor(value[1]));
            }));

        var chartWidth = parseInt(d3.select("figure").style("width"))*.45;

        var colorScaleType = d3.scale.ordinal().range(colorbrewer.Dark2[5]);

        typeChart.dimension(TypeDimension)
        .group(TypeGroup)
        .width(chartWidth)
        .height(chartWidth*1.5)
        .margins({top: 20, right: 0, bottom: -1, left: 0})
        .colors(colorScaleType);
   
        colorScaleCompany = d3.scale.ordinal().range(colorbrewer.Dark2[7]);

        resolutionChart
            .height(chartWidth*1.5)
            .width(chartWidth)
            .dimension(ResolutionDimension)
            .group(ResolutionGroup)
            .x(d3.scale.linear().domain(ResolutionExtent))
            .elasticY(true);
      
       
        colorScaleResolution = d3.scale.linear()
        .domain([ResolutionExtent[0],ResolutionExtent[1]])
        .range(["#9ecae1","#3182bd"]);

        colorScaleBrightness = d3.scale.linear()
        .domain([BrightnessExtent[0],BrightnessExtent[1]])
        .range(["#fdae6b","#e6550d"]);

        //font-family="Verdana" font-size="55" fill="blue"

        FieldNames = [
            "",
            "Resolution",
            "Price",
            "Weight",
            "Brightness",
            "Screen"];

        d3.select("tr#FieldNames").selectAll("th")
            .data(FieldNames)
            .enter()
            .append("th") 
            .append("text")
            .text(function(d){ return d;});


        dataTable
        .dimension(ResolutionDimension)
        .group(function(d) {return d.Type;})
        .columns([
        function(d) {return d.Item;},
        function(d) {return d.PPI;},
        function(d) {return d.Price;},
        function(d) {return d.WeightGrams;},
        function(d) {return d.BrightnessNits;},
        function(d) {return d.DiameterInches;}
        ]);

        dispatch.on("filter", function(value) {
               console.log(value);
               resolutionChart.replaceFilter(value);
               resolutionChart.redraw();
               dataTable.redraw();
               typeChart.redraw();
               countWidget.redraw();
        });

        countWidget
            .dimension(CrossFilter)
            .group(CrossFilter.groupAll());

        dc.renderAll()

        // function resize(){
            
        //     var ChartWidth = parseInt(d3.select("figure").style("width"))*.45;
        //     dc.renderAll();
        // };

        // // run resize function when the window changes
        // d3.select(window).on("resize",resize);

    });
</script>
</body>

</html>
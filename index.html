<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Screens</title>
        <script type="text/javascript" src="node_modules/d3/d3.js"></script>
        <script type="text/javascript" src="node_modules/crossfilter/crossfilter.js"></script>
        <script type="text/javascript" src="node_modules/dc/dc.js"></script>
        <link   type="text/css"        href="node_modules/dc/dc.css" rel="stylesheet">
        <script type="text/javascript" src="node_modules/jquery/dist/jquery.js"></script>
        <script type="text/javascript" src="node_modules/bootstrap/dist/js/bootstrap.js"></script>
        <link   type="text/css"        href="node_modules/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
        <script type="text/javascript" src="node_modules/colorbrewer/colorbrewer.js"></script>
        <link   type="text/css"        href="d3.slider/d3.slider.css" rel="stylesheet">
        <script type="text/javascript" src="d3.slider/d3.slider.js"></script>
   

    </head>

<style>
img.thumb {
    width:75px;
    height:auto;
}

td.dc-table-label {
    opacity:0.5;
}

</style>

<body>
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">

        <div class="container" id="container1">

            <div class="navbar-header">
                
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                
                <a class="navbar-brand">Catchy Screens</a>

            </div>
            
            <div class="collapse navbar-collapse">
                
                <ul class="nav navbar-nav"></ul>
            
            </div><!--/.nav-collapse -->

        </div>

    </div>

   

    <div class="container" role="main" id="container2">

        <div class="jumbotron">

            <div class="row" id="1">
                    <figure id="chart1" class="dc-chart col-md-6" style="display: none;">
                        <a class="reset" href="javascript:typeChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
                    </figure>
                    <figure id="chart2" class="dc-chart col-md-6" style="display: none;">
                        <a class="reset" href="javascript:resolutionChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
                    </figure>
                    <figure id="chart3" class="dc-chart col-md-6" style="display: none;">
                        <a class="reset" href="javascript:priceChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
                    </figure>
                    <figure id="chart4" class="dc-chart col-md-6" style="display: none;">
                        <a class="reset" href="javascript:weightChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
                    </figure>
                    <figure id="chart5" class="dc-chart col-md-6" style="display: none;">
                        <a class="reset" href="javascript:sizeChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
                    </figure>
                    <figure id="chart6" class="dc-chart col-md-6" style="display: none;">
                        <a class="reset" href="javascript:brightnessChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
                    </figure>                                                          
            </div> <!-- end row 1 -->
            
            <div class="row" id="2">
                <h5>Price <span id="sliderPricetextmin"> </span> , <span id="sliderPricetextmax"></span></h5>
                <div id="sliderPrice" class="d3-slider d3-slider-horizontal col-md-12" ></div>
            </div> <!-- end row 2 -->
          

            <div class="row" id="3">
                <h5>Resolution <span id="sliderResolutiontextmin"> </span> , <span id="sliderResolutiontextmax"></span></h5>
                <div id="sliderResolution" class="d3-slider d3-slider-horizontal col-md-12" ></div>
            </div> <!-- end row 3 -->

            <div class="row" id="4">
                <h5>Weight <span id="sliderWeighttextmin"> </span> , <span id="sliderWeighttextmax"></span></h5>
                <div id="sliderWeight" class="d3-slider d3-slider-horizontal col-md-12" ></div>
            </div> <!-- end row 4 -->

            <div class="row" id="5">
                <h5>Size <span id="sliderSizetextmin"> </span> , <span id="sliderSizetextmax"></span></h5>
                <div id="sliderSize" class="d3-slider d3-slider-horizontal col-md-12" ></div>
            </div> <!-- end row 5 -->

            <div class="row" id="6">
                <h5>Brightness <span id="sliderBrightnesstextmin"> </span> , <span id="sliderBrightnesstextmax"></span></h5>

                <div id="sliderBrightness" class="d3-slider d3-slider-horizontal col-md-12" ></div>
            </div> <!-- end row 6 -->

          
            <div class="row" id="7">
                <figure class="dc-chart dc-data-count col-md-12" style="display: block;">
                <span class="filter-count"></span> selected out of <span class="total-count"></span> records 
                </figure>
            </div> <!-- end row 7 -->

            <div class="row" id="8">
                <table id="list" class="table table-hover dc-data-table dc-chart col-md-12" style="margin-top:5%;">
                    <thead>
                        <tr id="FieldNames" class="header" style="text-align:left;"></tr>
                    </thead>
                </table> 
            </div> <!-- end row 8 -->


        </div> <!-- end jumbotron -->
    </div> <!-- end container -->
     
<script type="text/javascript">

    var formatNumber = d3.format( ",d");

    // var typeChart = dc.rowChart("figure#chart1");
    var resolutionChart = dc.barChart("figure#chart2");
    var priceChart = dc.barChart("figure#chart3");
    var weightChart = dc.barChart("figure#chart4");
    var sizeChart = dc.barChart("figure#chart5");
    var brightnessChart = dc.barChart("figure#chart6");

    var dataTable = dc.dataTable("#list");
    var countWidget = dc.dataCount("figure.dc-data-count");
    var dispatch = d3.dispatch("load","filter","render");
    
    var xf = crossfilter();
    var formatNumber = d3.format(",d");

    d3.csv('data/data.csv', function(Data){
        goData(Data);
    });

    dispatch.on("load", function(Data) {
            
            xf.add(Data);

        var BrightnessExtent = d3.extent(Data,function(d){return +d.BrightnessNits;}),
            PriceExtent = d3.extent(Data,function(d){return +d.Price;}),
            ResolutionExtent = d3.extent(Data,function(d){return +d.PPI;}),
            SizeExtent = d3.extent(Data,function(d){return +d.DiameterInches;}),
            WeightExtent = d3.extent(Data,function(d){return +d.WeightGrams;});

        var CompanyDimension = xf.dimension(function(d) { return d.Company;}),
            CompanyGroup = CompanyDimension.group(),

            BrightnessDimension = xf.dimension(function(d) { return d.BrightnessNits}),
            BrightnessGroup = BrightnessDimension.group(),

            PriceDimension = xf.dimension(function(d){ return d.Price;}),
            PriceGroup = PriceDimension.group();

            ResolutionDimension = xf.dimension(function(d) { return d.PPI;}),
            ResolutionGroup = ResolutionDimension.group(),

            SizeDimension = xf.dimension(function(d){ return d.DiameterInches;}),
            SizeGroup = SizeDimension.group(),
            
            TypeDimension = xf.dimension(function(d) { return d.Type;}),
            TypeGroup = TypeDimension.group(),

            WeightDimension = xf.dimension(function(d){return d.WeightGrams;}),
            WeightGroup = WeightDimension.group();  

            


        d3.select('span#sliderPricetextmin').text(formatNumber(Math.floor(PriceExtent[0])));
        d3.select('span#sliderPricetextmax').text(formatNumber(Math.floor(PriceExtent[1])));


        d3.select('span#sliderResolutiontextmin').text(Math.floor(ResolutionExtent[0]));
        d3.select('span#sliderResolutiontextmax').text(Math.floor(ResolutionExtent[1]));

        d3.select('span#sliderWeighttextmin').text(formatNumber(Math.floor(WeightExtent[0])));
        d3.select('span#sliderWeighttextmax').text(formatNumber(Math.floor(WeightExtent[1])));

        d3.select('span#sliderSizetextmin').text(Math.floor(SizeExtent[0]));
        d3.select('span#sliderSizetextmax').text(Math.floor(SizeExtent[1]));

        d3.select('span#sliderBrightnesstextmin').text(Math.floor(BrightnessExtent[0]));
        d3.select('span#sliderBrightnesstextmax').text(Math.floor(BrightnessExtent[1]));

        d3.select('#sliderPrice').call(d3.slider().axis(false).min(PriceExtent[0]).max(PriceExtent[1])
            .value(PriceExtent)
            .on("slide", function(evt, value) {
                var _newRange = dc.filters.RangedFilter(value[0],value[1]+1);
                dispatch.filter(_newRange,priceChart);
                d3.select('span#sliderPricetextmin').text(formatNumber(Math.floor(value[0])));
                d3.select('span#sliderPricetextmax').text(formatNumber(Math.floor(value[1])));
            }));

        d3.select('#sliderResolution').call(d3.slider().axis(false).min(ResolutionExtent[0]).max(ResolutionExtent[1])
            .value(ResolutionExtent)
            .on("slide", function(evt, value) {
                var _newRange = dc.filters.RangedFilter(value[0],value[1]+1);
                dispatch.filter(_newRange,resolutionChart);
                d3.select('span#sliderResolutiontextmin').text(Math.floor(value[0]));
                d3.select('span#sliderResolutiontextmax').text(Math.floor(value[1]));
        }));

        d3.select('#sliderWeight').call(d3.slider().axis(false).min(WeightExtent[0]).max(WeightExtent[1])
            .value(WeightExtent)
            .on("slide", function(evt, value) {
                var _newRange = dc.filters.RangedFilter(value[0],value[1]+1);
                dispatch.filter(_newRange,weightChart);
                d3.select('span#sliderWeighttextmin').text(formatNumber(Math.floor(value[0])));
                d3.select('span#sliderWeighttextmax').text(formatNumber(Math.floor(value[1])));
        }));

        d3.select('#sliderSize').call(d3.slider().axis(false).min(SizeExtent[0]).max(SizeExtent[1])
            .value(SizeExtent)
            .on("slide", function(evt, value) {
                var _newRange = dc.filters.RangedFilter(value[0],value[1]+1);
                dispatch.filter(_newRange,sizeChart);
                d3.select('span#sliderSizetextmin').text(Math.floor(value[0]));
                d3.select('span#sliderSizetextmax').text(Math.floor(value[1]));
        }));

        d3.select('#sliderBrightness').call(d3.slider().axis(false).min(BrightnessExtent[0]).max(BrightnessExtent[1])
            .value(BrightnessExtent)
            .on("slide", function(evt, value) {
                var _newRange = dc.filters.RangedFilter(value[0],value[1]+1);
                dispatch.filter(_newRange,brightnessChart);
                d3.select('span#sliderBrightnesstextmin').text(Math.floor(value[0]));
                d3.select('span#sliderBrightnesstextmax').text(Math.floor(value[1]));
        }));

        var chartWidth = 200;

        var colorScaleType = d3.scale.ordinal().range(colorbrewer.Dark2[5]);

        // typeChart.dimension(TypeDimension)
        // .group(TypeGroup)
        // .width(chartWidth)
        // .height(chartWidth*1.5)
        // .margins({top: 20, right: 0, bottom: -1, left: 0})
        // .colors(colorScaleType);
   
        // colorScaleCompany = d3.scale.ordinal().range(colorbrewer.Dark2[7]);

        resolutionChart
            .height(chartWidth)
            .width(chartWidth)
            .dimension(ResolutionDimension)
            .group(ResolutionGroup)
            .x(d3.scale.linear().domain(ResolutionExtent))
            .elasticY(true);

        priceChart
            .height(chartWidth)
            .width(chartWidth)
            .dimension(PriceDimension)
            .group(PriceGroup)
            .x(d3.scale.linear().domain(PriceExtent))
            .elasticY(true);

        weightChart
            .height(chartWidth)
            .width(chartWidth)
            .dimension(WeightDimension)
            .group(WeightGroup)
            .x(d3.scale.linear().domain(WeightExtent))
            .elasticY(true);

        sizeChart
            .height(chartWidth)
            .width(chartWidth)
            .dimension(SizeDimension)
            .group(SizeGroup)
            .x(d3.scale.linear().domain(SizeExtent))
            .elasticY(true);

        brightnessChart
            .height(chartWidth)
            .width(chartWidth)
            .dimension(BrightnessDimension)
            .group(BrightnessGroup)
            .x(d3.scale.linear().domain(BrightnessExtent))
            .elasticY(true);

        FieldNames = [
            ["",],
            ["Resolution","PPI"],
            ["Price","Price"],
            ["Weight","WeightGrams"],
            ["Brightness","BrightnessNits"],
            ["Screen","DiameterInches"]];

        d3.select("tr#FieldNames").selectAll("th")
            .data(FieldNames)
            .enter()
            .append("th")
            .append("a")
            .attr("href",function(d){ 
                return "javascript:dataTable.sortBy(function(d){return d." + d[1]+"});dataTable.redraw()"}) 
            .append("text")
            .text(function(d){ return d[0];});


        dataTable
        .dimension(ResolutionDimension)
        .group(function(d) {return d.Type;})
        .size(Infinity)
        .columns([
        function(d) {return d.Item;},
        function(d) {return d.PPI},
        function(d) {return formatNumber(Math.floor(d.Price));},
        function(d) {return formatNumber(Math.floor(d.WeightGrams));},
        function(d) {return d.BrightnessNits;},
        function(d) {return d.DiameterInches;},
        function(d) {return "<img src=img\\" + d.AmazonName + ".jpg class=\"thumb\">";}
        ]);

        dispatch.on("filter", function(value,_chart) {
            _chart.filterAll();
            _chart.replaceFilter(value);
            dc.renderAll()
        });

        countWidget
            .dimension(xf)
            .group(xf.groupAll());

        dispatch.render()

        

        // function resize(){
            
        //     var ChartWidth = parseInt(d3.select("figure").style("width"))*.45;
        //     dc.renderAll();
        // };

        // // run resize function when the window changes
        // d3.select(window).on("resize",resize);

    });

    dispatch.on('render',function(){

        dc.renderAll()

    })
    
    function hypotenuse(w,h) {
        var w = +w;
        var h = +h;
        var r = Math.sqrt(Math.pow(w,2) + Math.pow(h,2));
        return r;
    };
    
    function goData(Data) {
        Data.forEach(function(d){
            var TypeString = d.Type;
            var TypeSansSpace = TypeString.toLowerCase()
                .replace("desktop","")
                .replace(" ","");
            d.Price             = +d.Price
            d.WeightGrams       = +d.WeightGrams;
            d.DiameterInches    = +d.DiameterInches;
            d.HorizontalPixels  = +d.HorizontalPixels;
            d.VerticalPixels    = +d.VerticalPixels;
            d.BrightnessNits    = +d.BrightnessNits;
            d.PPI =  Math.round(hypotenuse(d.HorizontalPixels,d.VerticalPixels)/d.DiameterInches);
            d.Type = TypeSansSpace;
        });

        dispatch.load(Data);
        
    }
</script>
</body>

</html>
<!DOCTYPE html>
<html>
<head>

<!--     To Do 8/20/14
    1.  Format Table - done
    2.  Get SVG Bars to Adjust With Based on DIV Container -->
    <meta charset="utf-8">
    <title>Screens</title>
    <script type="text/javascript" src="lib/d3.js"></script>
    <script type="text/javascript" src="lib/crossfilter.js"></script>
    <script type="text/javascript" src="lib/dc.js"></script>
    <script type="text/javascript" src="lib/colorbrewer.js"></script>
    <link href="css/reset.css" rel="stylesheet" type="text/css" > 
    <link href="css/dc.css" rel="stylesheet" type="text/css" > 
    <link href="css/statvisions.css" rel="stylesheet" type="text/css" >
    <style>
    </style>
</head>

<body>

<div id="special">
    <h2>Gadget Types by Resolution, Brightness, Weight, Size and Price</h2> 
</div>
 
<div id="wrap">  

<header role="banner">
</header>

<div id="sidebar" role="complementary">
        <div id="Type" class="chart"></div>
</div>

<div id="main" role="main">

    <table id="list" class="table table-hover dc-data-table dc-chart" style="margin-top:5%;">
    <thead>
    <tr id="FieldNames" class="header" style="text-align:left;">
    </tr>
    </thead>
    </table> 

</div> <!-- /main -->

<div id="sidebar" role="complentary">
    <div id="Resolution" class="chart"><header><h5>Resolution(ppi)</h5></header></div>
    <div id="Brightness" class="chart"><header><h5>Brightness(nits)</h5></header></div>
    <div id="Company" class="chart"><header><h5>Company</h5></header></div>
</div> <!-- sidebar -->



<footer role="contentinfo">
StatVisions, Copyright 2014, All Rights Reserved
</footer>

</div>  <!-- /wrap --> 

     
<script type="text/javascript">

     
    

    d3.csv('data/data.csv', function(Data){

        function hypotenuse(w,h) {
            var w = +w;
            var h = +h;
            var r = Math.sqrt(Math.pow(w,2) + Math.pow(h,2));
            return r;
        };
        
        /* CONVERT TO NUMBERS AND CALCULATE PPI */
        Data.forEach(function(d){

            var PriceString = d.Price;
            var PriceNumber = Number(PriceString.replace(/[^0-9\.]+/g,""));

            var TypeString = d.Type;
            var TypeSansSpace = TypeString.toLowerCase()
                .replace("desktop","")
                .replace(" ","");


            
            d.Price             = +PriceNumber;
            d.WeightGrams       = +d.WeightGrams;
            d.DiameterInches    = +d.DiameterInches;
            d.HorizontalPixels  = +d.HorizontalPixels;
            d.VerticalPixels    = +d.VerticalPixels;
            d.BrightnessNits    = +d.BrightnessNits;
            
        
            d.PPI =  Math.round(hypotenuse(d.HorizontalPixels,d.VerticalPixels)/d.DiameterInches);
            
            d.Type = TypeSansSpace;


        });
        /*
        *  MIN AND MAX VALUES 
        */
        var BrightnessAccessor = function(d){return d.BrightnessNits;},
            BrightnessExtent = [],
            BrightnessExtent = d3.extent(Data,BrightnessAccessor);

        var ResolutionAccessor = function(d){return d.PPI;},
            ResolutionExtent = [],
            ResolutionExtent = d3.extent(Data,ResolutionAccessor);
        /*
        * CROSS FILTER, DIMENSIONS, GROUPS
        */
        var CrossFilter = crossfilter(Data),
            TypeDimension = CrossFilter.dimension(function(d) { return d.Type;}),
            TypeGroup = TypeDimension.group(),
            CompanyDimension = CrossFilter.dimension(function(d) { return d.Company;}),
            CompanyGroup = CompanyDimension.group(),
            ResolutionDimension = CrossFilter.dimension(function(d) { return d.PPI;}),
            ResolutionGroup = ResolutionDimension.group(),
            BrightnessDimension = CrossFilter.dimension(function(d) { return +d.BrightnessNits}),
            BrightnessGroup = BrightnessDimension.group();

        // ResolutionDimension.filter([100,200]);
        
        /*
        * CHARTS
        */

        var chartWidth = parseInt(d3.select("div#sidebar").style("width"))*.45;

        var colorScaleType = d3.scale.ordinal().range(colorbrewer.Dark2[5]),

        typeChart = dc.rowChart("#Type")
        .dimension(TypeDimension)
        .group(TypeGroup)
        .width(chartWidth)
        .height(300)
        .margins({top: 0, right: 0, bottom: -1, left: 0})
        .colors(colorScaleType),
   
        colorScaleCompany = d3.scale.ordinal().range(colorbrewer.Dark2[7]),

        CompanyChart = dc.rowChart("#Company")
        .dimension(CompanyDimension)
        .group(CompanyGroup)
        .width(chartWidth)
        .margins({top: 0, right: 0, bottom: -1, left: 0})
        .colors(colorScaleCompany),

        colorScaleResolution = d3.scale.linear()
        .domain([ResolutionExtent[0],ResolutionExtent[1]])
        .range(["#9ecae1","#3182bd"]),

        resolutionChart = dc.rowChart("#Resolution")
        .dimension(ResolutionDimension)
        .group(ResolutionGroup)
        .width(chartWidth)
        .margins({top: 0, right: 0, bottom: -1, left: 0})
        .colors(colorScaleResolution), 

        colorScaleBrightness = d3.scale.linear()
        .domain([BrightnessExtent[0],BrightnessExtent[1]])
        .range(["#fdae6b","#e6550d"]),

        BrightnessChart = dc.rowChart("#Brightness")
        .dimension(Brightness)
        .group(BrightnessGroup)
        .width(chartWidth)
        .margins({top: 0, right: 0, bottom: -1, left: 0})
        .colors(colorScaleBrightness),

        // Data Table Field Names
        FieldNames = [
            "",
            "Resolution",
            "Price",
            "Weight",
            "Brightness",
            "Screen"];
            // "Model",
            // "Availability",
            // "Data Source 1", 
            // "Data Source 2"]; 

        d3.select("tr#FieldNames").selectAll("th")
            .data(FieldNames)
            .enter()
            .append("th") 
            .append("text")
            .text(function(d){ return d;});


        list = dc.dataTable("#list")
        .dimension(TypeDimension)
        .group(function(d) {return d.Type;})
        .columns([
        function(d) {return d.Item;},
        function(d) {return d.PPI;},
        function(d) {return d.Price;},
        function(d) {return d.WeightGrams;},
        function(d) {return d.BrightnessNits;},
        function(d) {return d.DiameterInches;}
        // function(d) {return d.Model;},
        // function(d) {return "<a href='" + d.PriceSource + "'>Buy Now</a>";},
        // function(d) {return "<a href='" + d.DataSource01 + "'>url</a>";},
        // function(d) {return "<a href='" + d.DataSource02 + "'>url</a>";}
        ]);

        dc.renderAll()




        function resize(){
            
            var ChartWidth = parseInt(d3.select("div#sidebar").style("width"))*.45;
            dc.renderAll();
            d3.selectAll(".dc-chart g.row rect").attr("rx",8);
        };

        // run resize function when the window changes
        d3.select(window).on("resize",resize);

        d3.selectAll(".dc-chart g.row rect").attr("rx",8);

   // "item":"Samsung Galaxy Tab Pro 8.4",
   //  "Company":"Samsung",
   //  "type":"tablet",
   //  "di":8.4,
   //  "hp":1600,
   //  "wp":2560,
   //  "dp":3019,
   //  "PPI":359,
   //  "BrightnessNits":410,
   //  "Model":"SM-T320NZWAXAR",
   //  "data_source":"http://www.samsung.com/us/mobile/galaxy-tab/SM-T320NZWAXAR",
   //  "collected_date":"06/10/14",
   //  "data_source_Brightness":"http://www.phonearena.com/reviews/Samsung-Galaxy-Tab-PRO-8.4-Review_id3588"
 




    });
</script>

</body>

</html>